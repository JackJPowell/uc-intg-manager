<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Integration Manager{% endblock %} - Unfolded Circle</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'uc-primary': '#6366f1',
                        'uc-secondary': '#4f46e5',
                        'uc-accent': '#818cf8',
                        'uc-dark': '#1e1e2e',
                        'uc-darker': '#11111b',
                        'uc-card': '#313244',
                        'uc-border': '#45475a',
                    }
                }
            }
        }
    </script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Custom styles -->
    <style>
        .htmx-indicator {
            display: none;
        }
        .htmx-request .htmx-indicator {
            display: inline-block;
        }
        .htmx-request.htmx-indicator {
            display: inline-block;
        }
        
        /* Show overlays when they're specifically targeted by HTMX */
        /* Generic overlay targeting - works with any ID */
        [id^="upgrade-overlay-"].htmx-request,
        [id^="backup-overlay-"].htmx-request,
        [id^="overlay-"].htmx-request {
            display: flex !important;
            pointer-events: auto !important;
        }
        
        /* Loading spinner */
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Fade in animation for HTMX content */
        .htmx-added {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Card hover effect */
        .integration-card {
            transition: box-shadow 0.2s ease;
            overflow: visible;
        }
        .integration-card:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="h-full bg-uc-darker text-gray-100">
    <div class="min-h-full flex flex-col">
        <!-- Header -->
        <header class="bg-uc-dark border-b border-uc-border">
            <div class="max-w-12xl mx-auto px-3 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-2 sm:space-x-3">
                        <!-- Mobile menu button -->
            <button id="mobile-menu-button" type="button" class="md:hidden p-2 text-gray-400 hover:text-white hover:bg-uc-card rounded-lg transition-colors focus:outline-none" onclick="toggleMobileMenu()">
                <i class="fa-solid fa-bars h-6 w-6"></i>
            </button>
                        
                        <div class="flex-shrink-0 flex items-center space-x-2 sm:space-x-3">
                            <svg class="h-6 sm:h-8 w-6 sm:w-8 text-uc-primary" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <div>
                                <h1 class="text-base sm:text-xl font-bold text-white">Integration Manager</h1>
                            </div>
                        </div>
                    </div>
                    <div id="status-indicator" 
                         hx-get="/api/status/html" 
                         hx-trigger="load, every 30s"
                         hx-swap="innerHTML"
                         class="flex items-center gap-2">
                        <span class="htmx-indicator spinner"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex-1 flex relative">
            <!-- Mobile Overlay -->
            <div id="mobile-overlay" class="hidden lg:hidden fixed inset-0 bg-black bg-opacity-50 z-20" onclick="toggleMobileMenu()"></div>
            
            <!-- Sidebar Navigation -->
            <nav id="mobile-sidebar" class="fixed lg:static inset-y-0 left-0 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-30 w-64 bg-uc-dark border-r border-uc-border flex-shrink-0">
                <div class="p-4 space-y-2">
                    <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">
                        Management
                    </h2>
                    
                    <a href="/" 
                       class="flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if request.endpoint == 'index' %}bg-uc-primary text-white{% else %}text-gray-300 hover:bg-uc-card hover:text-white{% endif %} transition-colors">
                        <i class="fa-regular fa-house mr-3 text-lg"></i>
                        Dashboard
                    </a>
                    
                    <a href="/integrations" 
                       class="flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if request.endpoint == 'integrations_page' %}bg-uc-primary text-white{% else %}text-gray-300 hover:bg-uc-card hover:text-white{% endif %} transition-colors">
                        <i class="fa-solid fa-list-check mr-3 text-lg"></i>
                        Your Integrations
                    </a>
                    
                    <a href="/available" 
                       class="flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if request.endpoint == 'available_page' %}bg-uc-primary text-white{% else %}text-gray-300 hover:bg-uc-card hover:text-white{% endif %} transition-colors">
                        <i class="fa-solid fa-plus mr-3 text-lg"></i>
                        Available Integrations
                    </a>
                    
                    <div class="pt-6">
                        <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">
                            System
                        </h2>
                        
                        <a href="/settings" 
                           class="flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if request.endpoint == 'settings_page' %}bg-uc-primary text-white{% else %}text-gray-300 hover:bg-uc-card hover:text-white{% endif %} transition-colors">
                            <i class="fa-solid fa-gear mr-3 text-lg"></i>
                            Settings
                        </a>
                        
                        <a href="/logs" 
                           class="flex items-center px-4 py-3 text-sm font-medium rounded-lg {% if request.path == '/logs' %}bg-uc-card text-white{% else %}text-gray-300 hover:bg-uc-card hover:text-white{% endif %} transition-colors">
                            <i class="fa-regular fa-file-lines mr-3 text-lg"></i>
                            Logs
                        </a>
                    </div>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="flex-1 overflow-auto">
                <div class="max-w-7xl mx-auto px-3 sm:px-6 py-4 sm:py-8">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="bg-uc-dark border-t border-uc-border">
            <div class="max-w-12xl mx-auto px-3 sm:px-6 lg:px-8 py-4">
                <div class="flex flex-col sm:flex-row items-center justify-between gap-2 sm:gap-0 text-xs sm:text-sm text-gray-400">
                    <div>
                        Integration Manager v1.0.5
                    </div>
                    <div class="flex items-center space-x-3 sm:space-x-4">
                        <a href="https://github.com/jackjpowell/uc-intg-manager" target="_blank" rel="noopener" 
                           class="hover:text-white transition-colors">
                            GitHub
                        </a>
                        <span>â€¢</span>
                        <a href="https://www.unfoldedcircle.com" target="_blank" rel="noopener"
                           class="hover:text-white transition-colors">
                            Unfolded Circle
                        </a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Mobile Menu Toggle Script -->
    <script>
        function toggleMobileMenu() {
            const sidebar = document.getElementById('mobile-sidebar');
            const overlay = document.getElementById('mobile-overlay');
            const menuIcon = document.getElementById('menu-icon');
            const closeIcon = document.getElementById('close-icon');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
            menuIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('hidden');
        }
        
        // Toggle dropdown menu
        function toggleDropdown(event, dropdownId, forceClose = false) {
            event.stopPropagation();
            const dropdown = document.getElementById(dropdownId);
            const chevronId = dropdownId.replace('dropdown-', 'chevron-');
            const chevron = document.getElementById(chevronId);
            
            if (forceClose || !dropdown.classList.contains('hidden')) {
                dropdown.classList.add('hidden');
                if (chevron) chevron.classList.remove('fa-rotate-180');
            } else {
                // Close all other dropdowns first
                document.querySelectorAll('[id^="dropdown-"]').forEach(d => {
                    if (d.id !== dropdownId) {
                        d.classList.add('hidden');
                        const otherId = d.id.replace('dropdown-', 'chevron-');
                        const otherChevron = document.getElementById(otherId);
                        if (otherChevron) otherChevron.classList.remove('fa-rotate-180');
                    }
                });
                dropdown.classList.remove('hidden');
                if (chevron) chevron.classList.add('fa-rotate-180');
            }
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('[id^="dropdown-"]') && !event.target.closest('button')) {
                document.querySelectorAll('[id^="dropdown-"]').forEach(d => {
                    d.classList.add('hidden');
                    const chevronId = d.id.replace('dropdown-', 'chevron-');
                    const chevron = document.getElementById(chevronId);
                    if (chevron) chevron.classList.remove('fa-rotate-180');
                });
            }
        });
        
        // Close menu when clicking a link on mobile
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('mobile-sidebar');
            const links = sidebar.querySelectorAll('a');
            links.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth < 1024) {
                        toggleMobileMenu();
                    }
                });
            });
        });
    </script>
</body>
</html>
